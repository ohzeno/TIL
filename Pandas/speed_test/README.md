# Pandas 최적화를 위한 반복 속도 테스트

### 실험 이유

>시계열 데이터를 이용한 테스트의 경우 열끼리 바로 계산하는 것이 아니라 행을 순서대로 하나하나 확인해봐야 할 경우가 있다. 
>그래서 판다스 최적화 관련 글을 보고 테스트를 해보았다. 
>https://aldente0630.github.io/data-science/2018/08/05/a-beginners-guide-to-optimizing-pandas-code-for-speed.html
>
>1만줄짜리 csv파일을 100번, 50번 for 루프로 반복하여 짧은 데이터로 인한 오차를 줄였다.

```
# 100만줄 if문
simple_for_mil(df)  # 0:00:02.214019
iterrows_mil(df)  # 0:00:17.859303
itertuples_mil(df)  # 0:00:00.576001

# 50만줄 전부 함수적용
simple_for_func(df.copy())  # 0:00:03.104001
iterrows_func(df.copy())  # 0:00:12.966031
itertuples_func(df.copy())  # 0:00:02.060000

t1 = datetime.datetime.now()
for _ in range(50):
    df['고가'] = df['저가'] * 2
t2 = datetime.datetime.now()
print(f'열계산: {t2 - t1}')  # 0:00:00.009009
```

- 결과
  - 단순 for문이 iterrows보다 4배 느리다는 과거 데이터들과 달리 현재는 단순 for문이 4~8배 빨랐다.
    - 최적화 상황의 예외인 경우를 고려해 if문 뿐 아니라 모든 행에 함수를 적용해보기도 했다.
      - 두 경우 모두 단순 for문이 빨랐다.
    - 원본 글이 있는 사이트에 연결할 수 없어 날짜를 확인할 수 없다. 너무 오래된 글이라 판다스와 파이썬의 버전이 달라지면서 성능에 차이가 생겼을 가능성이 있다.
      - 한글 자료들은 최신글이더라도 인용 원문의 작성 년도가 2014년 등으로 오래된 경우가 많았다.
  - 다행히 itertuples는 오차를 감안하더라도 단순 for문보다 빨랐다. 앞으로 단순 행 반복은 itertuples를 사용해야겠다.
    - if문 적용시 if문 내부가 한 번만 실행되었기에 for문보다 4배가량 빨랐으나
    - 모든 줄 함수적용 시에는 함수 적용이 병목이 되어 1.5배 정도의 차이밖에 없었던 것 같다.
  - df 자체 기능으로 열끼리 직접 계산하는 것이 가장 빠른 것은 확실하다.
